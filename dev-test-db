#!/usr/bin/env bash
set -euo pipefail

cd "$(dirname "$0")"
export PROJMAN_DB="projman-test.db"
export PROJMAN_PORT=${PROJMAN_PORT:-18080}
# Limpa o test DB anterior
./clear-test-db || true

# Inicia o servidor com auto-reload na porta de teste em background
./dev-server &
SERVER_PID=$!

# Aguarda o servidor inicializar e popula o banco de dados
./populate-test-db

# Aguarda o servidor (que est√° em background)
wait $SERVER_PID
